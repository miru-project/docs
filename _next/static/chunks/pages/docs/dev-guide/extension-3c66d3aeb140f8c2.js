(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{3591:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/dev-guide/extension",function(){return n(1602)}])},1602:function(e,s,n){"use strict";n.r(s);var l=n(1527),r=n(9870),i=n(6736);n(6039);var o=n(780);function c(e){let s=Object.assign({h1:"h1",p:"p",a:"a",h2:"h2",h3:"h3",code:"code",pre:"pre",span:"span",strong:"strong"},(0,i.ah)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.h1,{children:"扩展开发"}),"\n",(0,l.jsxs)(s.p,{children:["开发扩展需要明白 Javascript 的正则表达式如果你不熟悉正则表达式可以先学习一下 《",(0,l.jsx)(s.a,{href:"https://zh.javascript.info/regexp-methods",children:"正则表达式和字符串的方法"}),"》 和 《",(0,l.jsx)(s.a,{href:"https://deerchao.net/tutorials/regex/regex.htm",children:"正则表达式 30 分钟入门教程"}),"》。"]}),"\n",(0,l.jsxs)(s.p,{children:["本文档默认你已经按照 ",(0,l.jsx)(s.a,{href:"/docs/dev-guide/environment",children:"开发环境"})," 配置好了开发环境。"]}),"\n","\n",(0,l.jsx)(s.h2,{id:"快速开始",children:"快速开始"}),"\n",(0,l.jsxs)(o.Rg,{children:[(0,l.jsx)(s.h3,{id:"创建扩展文件",children:"创建扩展文件"}),(0,l.jsxs)(s.p,{children:["在本地部署的 ",(0,l.jsx)(s.a,{href:"/docs/dev-guide/environment#%E9%83%A8%E7%BD%B2%E4%BB%93%E5%BA%93",children:(0,l.jsx)(s.code,{children:"Miru 仓库"})}),"中的 ",(0,l.jsx)(s.code,{children:"repo"})," 文件夹中创建你的扩展文件，用你所要创建扩展的包名命名，例如 ",(0,l.jsx)(s.code,{children:"repo/xxx.xxx.xxx.js"}),"。"]}),(0,l.jsx)(s.h3,{id:"编写元数据",children:"编写元数据"}),(0,l.jsxs)(s.p,{children:["在扩展文件中编写元数据，元数据是一个以 ",(0,l.jsx)(s.code,{children:"// ==MiruExtension=="})," 开头 ",(0,l.jsx)(s.code,{children:"// ==/MiruExtension=="}),"结束的注释，包含了扩展的基本信息，例如包名、版本、作者、描述等，例如："]}),(0,l.jsx)(s.pre,{"data-language":"text","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// ==MiruExtension=="})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @name  Extension Name"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @version v0.0.1"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @author Xxxx"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @lang zh-cn"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @icon https://xxx.xxx.xxx/xxx.png"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @package xxx.xxx.xxx"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @type bangumi"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// @webSite https://xxx.xxx.xxx/"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// ==/MiruExtension=="})})]})}),(0,l.jsx)(o.UW,{children:(0,l.jsxs)(s.p,{children:["其中 ",(0,l.jsx)(s.code,{children:"@name"}),"、",(0,l.jsx)(s.code,{children:"@version"}),"、",(0,l.jsx)(s.code,{children:"@webSite"}),"、",(0,l.jsx)(s.code,{children:"@package"}),"、",(0,l.jsx)(s.code,{children:"@type"})," 为必填项，其他为可选项。\n",(0,l.jsx)(s.code,{children:"@webSite"})," 是扩展的目标地址"]})}),(0,l.jsx)(s.h3,{id:"继承-extension-类",children:"继承 Extension 类"}),(0,l.jsxs)(s.p,{children:["在扩展文件中暴露一个 类 并继承 ",(0,l.jsx)(s.code,{children:"Extension"})," 类，例如："]}),(0,l.jsx)(s.pre,{"data-language":"javascript","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(s.code,{"data-language":"javascript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"extends"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Extension"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),(0,l.jsx)(s.h3,{id:"重写扩展内的方法",children:"重写扩展内的方法"}),(0,l.jsxs)(s.p,{children:["在扩展类中重写 ",(0,l.jsx)(s.code,{children:"Extension"})," 类中的方法，例如："]}),(0,l.jsx)(s.pre,{"data-language":"javascript","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(s.code,{"data-language":"javascript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"extends"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Extension"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"latest"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 最近更新"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"search"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 搜索"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"detail"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 详情"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"watch"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(){"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 观看"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),(0,l.jsx)(o.UW,{children:(0,l.jsxs)(s.p,{children:["其中返回的数据都得按照 ",(0,l.jsx)(s.a,{href:"/docs/dev-guide/data",children:"数据格式"})," 返回。"]})}),(0,l.jsxs)(o.UW,{children:[(0,l.jsxs)(s.p,{children:["请求数据可以使用 ",(0,l.jsx)(s.code,{children:"this.request"})," 方法，例如："]}),(0,l.jsx)(s.pre,{"data-language":"javascript","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(s.code,{"data-language":"javascript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"res"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".request"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"({"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    url"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'/xxx'"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    method"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'GET'"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"this.request"})," 是通过代理的请求 如果不使用 ",(0,l.jsx)(s.code,{children:"this.request"})," 将可能收到跨域错误。\n关于请求可以参考 ",(0,l.jsx)(s.a,{href:"https://github.com/umijs/umi-request/blob/master/README",children:"umi-request"})]})]}),(0,l.jsxs)(s.h3,{id:"提交到-miru-官方仓库",children:["提交到 ",(0,l.jsx)(s.code,{children:"Miru 官方仓库"})]}),(0,l.jsxs)(s.p,{children:["请使用 ",(0,l.jsx)(s.code,{children:"PR"})," 的方式来提交你的扩展到 ",(0,l.jsx)(s.code,{children:"Miru 官方仓库"}),"，提交的 ",(0,l.jsx)(s.code,{children:"PR"})," 需要包含你的扩展文件且",(0,l.jsx)(s.strong,{children:"不需要"})," ",(0,l.jsx)(s.code,{children:"index.json"})," 文件。"]})]}),"\n",(0,l.jsx)(s.h2,{id:"本地调试",children:"本地调试"}),"\n",(0,l.jsxs)(s.p,{children:["在本地调试扩展时要在 ",(0,l.jsx)(s.code,{children:"Miru"})," 设置的 ",(0,l.jsx)(s.code,{children:"仓库"})," 地址改为本地的仓库地址(LiveServe 启动的地址)，然后如果你安装了 ",(0,l.jsx)(s.code,{children:"go"})," 的环境可以在 本地 Miru 仓库 使用 ",(0,l.jsx)(s.code,{children:"go run main.go"})," 来生成扩展的索引文件,否则请手动修改 ",(0,l.jsx)(s.code,{children:"index.json"})," 文件来使 Miru 检索到你的扩展"]}),"\n",(0,l.jsx)(s.h2,{id:"例子",children:"例子"}),"\n",(0,l.jsxs)(s.p,{children:["可以前往 ",(0,l.jsx)(s.a,{href:"https://miru-repo.0n0.dev",children:"Miru 官方仓库"})]})]})}s.default=(0,r.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(c,{...e})}):c(e)},pageOpts:{filePath:"pages/docs/dev-guide/extension.mdx",route:"/docs/dev-guide/extension",headings:[{depth:1,value:"扩展开发",id:"扩展开发"},{depth:2,value:"快速开始",id:"快速开始"},{depth:3,value:"创建扩展文件",id:"创建扩展文件"},{depth:3,value:"编写元数据",id:"编写元数据"},{depth:3,value:"继承 Extension 类",id:"继承-extension-类"},{depth:3,value:"重写扩展内的方法",id:"重写扩展内的方法"},{depth:3,value:"提交到 Miru 官方仓库",id:"提交到-miru-官方仓库"},{depth:2,value:"本地调试",id:"本地调试"},{depth:2,value:"例子",id:"例子"}],title:"扩展开发"},pageNextRoute:"/docs/dev-guide/extension"})}},function(e){e.O(0,[870,774,888,179],function(){return e(e.s=3591)}),_N_E=e.O()}]);